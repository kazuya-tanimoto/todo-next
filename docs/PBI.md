# Product Backlog

## 凡例

- 🔴 高 / 🟡 中 / 🟢 低
- ステータス: `TODO` → `IN PROGRESS` → `DONE`

---

## 新機能

### PBI-001: ユーザー名（ニックネーム）登録
- **優先度**: 🔴 高
- **ステータス**: `TODO`
- **目的**: 共有リストで「誰が参加しているか」を表示するための基盤。メールアドレスではなく親しみやすい名前で識別できるようにする。PBI-002, 003の前提。
- **概要**: 初回ログイン時にニックネームを登録させる。共有リストでの表示名として使用。
- **要件**:
  - Google OAuth後、プロフィール未設定なら登録画面に遷移
  - `profiles` テーブル追加（user_id, display_name, created_at）
  - 後から変更可能にする

### PBI-002: 共有メンバーの可視化
- **優先度**: 🔴 高
- **ステータス**: `TODO`
- **依存**: PBI-001
- **目的**: 家族でリストを共有する際、誰が参加しているか把握できないと不安。「ちゃんと共有できてる？」の確認手段を提供する。
- **概要**: 共有リストに誰が参加しているか確認できるようにする。
- **要件**:
  - リスト詳細 or ShareDialogでメンバー一覧表示（ニックネーム表示）
  - オーナーにはバッジ or ラベル表示

### PBI-003: オーナー/共有の視覚的区別
- **優先度**: 🔴 高
- **ステータス**: `TODO`
- **依存**: PBI-001
- **目的**: リストが増えると「これ自分のリスト？共有されたやつ？」が分からなくなる。一目で区別できることで誤操作（他人のリストを削除等）を防ぐ。
- **概要**: リスト一覧で、自分がオーナーのリストと共有されたリストを視覚的に区別する。
- **要件**:
  - 共有リストにアイコンやラベル（例: 👤オーナー / 🤝共有）
  - オーナー名を表示

### PBI-004: ゴミ箱機能（ソフトデリート）
- **優先度**: 🟡 中
- **ステータス**: `TODO`
- **目的**: 誤削除の救済手段。特に共有リストでは他のメンバーが追加したTodoを誤って消すリスクがあり、復元できないと信頼性が損なわれる。
- **概要**: 削除したTodo・リストを30日間ゴミ箱に保持し、復元可能にする。
- **要件**:
  - `deleted_at` カラム追加（todos, lists）
  - 削除操作は `deleted_at` をセット（物理削除しない）
  - ゴミ箱画面で一覧表示・復元・完全削除
  - 30日経過後に自動削除（Supabase cron or Edge Function）

### PBI-005: タグ機能
- **優先度**: 🔴 高
- **ステータス**: `TODO`
- **目的**: Todoを分類・フィルタリングすることで、リスト内の情報整理を可能にする。将来的にこのアプリ自身でPBI管理するための基盤でもある（優先度・種別をタグで表現）。
- **概要**: Todoにタグを付けて分類・フィルタリングできるようにする。
- **要件**:
  - `tags` テーブル（id, list_id, name, color）
  - `todo_tags` 中間テーブル（todo_id, tag_id）
  - Todo作成・編集時にタグ選択
  - タグでフィルタリング

### PBI-006: ソート機能
- **優先度**: 🔴 高
- **ステータス**: `TODO`
- **目的**: 買い物リストでは「店の動線順」、PBI管理では「優先度順」など、用途に応じた並び替えが必要。現状は作成順固定で使い勝手が悪い。ドッグフーディング（このアプリでPBI管理）の前提条件。
- **概要**: Todoの並び替え（手動ドラッグ&ドロップ、作成日、名前順など）。
- **要件**:
  - `position` カラム追加（todos）
  - ドラッグ&ドロップUI（dnd-kit等）
  - ソート切り替え（手動 / 作成日 / 名前 / 完了状態）

### PBI-007: Todoの詳細表示（開閉式）
- **優先度**: 🔴 高
- **ステータス**: `TODO`
- **目的**: Todoタイトルだけでは伝えきれない補足情報（手順、メモ、リンク等）を記録したい。PBI管理のドッグフーディングでも、各項目に詳細を書けないと実用に耐えない。
- **概要**: Todoをクリック/タップで開閉し、補足情報（description）を表示・編集できるようにする。
- **要件**:
  - `description` カラム追加（todos）
  - クリックでアコーディオン展開/折りたたみ
  - 展開時に補足テキストを表示・編集
  - リアルタイム同期

### PBI-008: Todo編集
- **優先度**: 🟡 中
- **ステータス**: `TODO`
- **目的**: タイポ修正や内容の更新のために、一度作ったTodoを削除→再作成するのは手間。インライン編集で手軽に直せるようにする。
- **概要**: 作成済みTodoのタイトルを編集できるようにする。
- **要件**:
  - インライン編集（タップ or ダブルクリックで編集モード）
  - 編集のリアルタイム同期

### PBI-009: Todoの期限設定
- **優先度**: 🟡 中
- **ステータス**: `TODO`
- **目的**: 買い物は「今日中」、PBIは「今週中」など、期限を可視化することでタスクの緊急度を把握しやすくする。期限切れのハイライトで見落とし防止。
- **概要**: Todoに期限（due date）を設定できるようにする。
- **要件**:
  - `due_date` カラム追加（todos）
  - 日付ピッカーUI
  - 期限切れ・期限間近のビジュアル表示（色変え等）
  - ソート条件に期限を追加（PBI-006と連携）

### PBI-010: Todo複製
- **優先度**: 🟢 低
- **ステータス**: `TODO`
- **目的**: 定期的な買い物リスト等、似たTodoを何度も作るケースで入力の手間を省く。
- **概要**: 既存のTodoを複製して新しいTodoを作成する。
- **要件**:
  - 複製ボタン or メニュー
  - タイトル・タグ・詳細をコピー（完了状態はリセット）

### PBI-011: 音声入力
- **優先度**: 🟢 低
- **ステータス**: `TODO`
- **目的**: スマホで買い物リストを作るとき、キーボード入力は面倒。音声でサッと追加できると実用性が大幅に上がる。
- **概要**: 音声認識でTodoを追加できるようにする。
- **要件**:
  - Web Speech API（SpeechRecognition）
  - マイクボタンUI
  - 認識結果をTodoタイトルに反映
  - ブラウザ対応状況のフォールバック

### PBI-012: 完了済みTodoの一括削除
- **優先度**: 🟢 低
- **ステータス**: `TODO`
- **目的**: 買い物完了後など、チェック済みの項目が溜まるとリストが見づらい。一括で片付けてリストをスッキリさせる。
- **概要**: 完了済みTodoをまとめて削除（ゴミ箱へ移動）するボタン。
- **要件**:
  - 「完了済みを削除」ボタン
  - 確認ダイアログ
  - PBI-004（ゴミ箱）と連携

### PBI-013: PWA対応
- **優先度**: 🟢 低
- **ステータス**: `TODO`
- **目的**: 外出先でスマホからサッと開きたい。ブラウザのタブを探すのではなく、ホーム画面のアイコンから一発で起動できる体験を提供する。
- **概要**: スマホでアプリっぽく使えるようにする。
- **要件**:
  - Web App Manifest
  - Service Worker（オフライン時の基本表示）
  - ホーム画面追加対応

---

## リファクタ・技術改善

### PBI-014: ESLint → Biome移行
- **優先度**: 🟡 中
- **ステータス**: `TODO`
- **目的**: ESLint + Prettierの2ツール構成は設定が複雑で遅い。Biomeに統一することでシンプルかつ高速なLint/Format環境にする。
- **概要**: ESLint + Prettierの構成をBiomeに統一する。
- **要件**:
  - Biome導入・設定
  - ESLint / Prettier関連パッケージ削除
  - CI設定更新（あれば）

### PBI-015: ライブラリ更新
- **優先度**: 🟢 低
- **ステータス**: `TODO`
- **目的**: 古いライブラリはセキュリティリスクやバグの温床。定期的に棚卸しして健全な状態を保つ。
- **概要**: 古いライブラリを最新かつシェアのあるものに更新。
- **要件**:
  - 依存パッケージの棚卸し
  - 非推奨・メンテ停止ライブラリの代替検討

### PBI-016: コード最適化
- **優先度**: 🟢 低
- **ステータス**: `TODO`
- **目的**: 機能追加に伴いコードが肥大化する前に、構造を整理して保守性を確保する。新機能の実装速度にも直結する。
- **概要**: コンポーネント分割、カスタムhooks抽出、ディレクトリ構成の機能別整理。
- **要件**:
  - 大きなコンポーネントの分割検討
  - Supabase操作のカスタムhooks化
  - `src/features/` 等の機能別ディレクトリ構成への移行（必要に応じて）

### PBI-017: E2Eテスト自動化
- **優先度**: 🟢 低
- **ステータス**: `TODO`
- **目的**: 手動E2E確認は時間がかかり漏れも出る。自動化してリグレッションを防ぎ、安心してリファクタ・機能追加できるようにする。
- **概要**: Playwright導入でE2Eテストを自動化。
- **要件**:
  - Playwright設定
  - 認証フロー（TESTING.mdの方針に従う）
  - 主要フローのテスト（Todo CRUD、リスト管理、共有）
